import smtplib
import schedule
import time
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
from email.mime.application import MIMEApplication
import os
import threading
from flask import Flask

app = Flask(__name__)

EMAIL_ADDRESS = 'vigneshmudhale777@gmail.com'
EMAIL_PASSWORD = 'yillyowmajucuagr'

recipient_list = [
    'support@dbatu.ac.in',
    'dbatu_suport@unisuite.in',
    'acoe_engg@dbatu.ac.in',
    'exam@dbatu.ac.in',
    'smpore@dbatu.ac.in'
]

subject = "MSI рдкреЛрд░реНрдЯрд▓рд╡рд░реАрд▓ рдЪреБрдХреАрдЪреА рдмреЕрдХрд▓реЙрдЧ рдорд╛рд╣рд┐рддреА рд╡ рдлреА рд╕рдВрджрд░реНрднрд╛рддреАрд▓ рдЕрдбрдЪрдг тАУ рд╡рд┐рдирдВрддреА"

body = """

рдЖрджрд░рдгреАрдп рдкрд░реАрдХреНрд╖рд╛ рдирд┐рдпрдВрддреНрд░рдХ рдорд╣реЛрджрдп/рдорд╣реЛрджрдпрд╛,
рд╕рдкреНрд░реЗрдо рдирдорд╕реНрдХрд╛рд░,

рдореА рд╡рд┐рдШреНрдиреЗрд╢ рд╕рд┐рджреНрдзреВ рдореБрдзрд╛рд│реЗ, рджреНрд╡рд┐рддреАрдп рд╡рд░реНрд╖ рдмреА.рдЯреЗрдХ (рдЗрд▓реЗрдХреНрдЯреНрд░реЙрдирд┐рдХреНрд╕ рд╡ рдЯреЗрд▓рд┐рдХрдореНрдпреБрдирд┐рдХреЗрд╢рди) рд╢рд╛рдЦреЗрдЪрд╛ рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдЖрд╣реЗ. рдорд╛рдЭрд╛ PRN рдХреНрд░рдорд╛рдВрдХ 23062171372016 рдЕрд╕реВрди рдореА Ashokrao Mane Group of Institutions, рд╡рд╛рдард╛рд░ рддрд░реНрдл рд╡рдбрдЧрд╛рд╡, рдХреЛрд▓реНрд╣рд╛рдкреВрд░ рдпрд╛ рдорд╣рд╛рд╡рд┐рджреНрдпрд╛рд▓рдпрд╛рдд рд╢рд┐рдХрддреЛ.
рдорд╛рдЭреНрдпрд╛ рддрд┐рд╕рд▒реНрдпрд╛ рд╕рддреНрд░рд╛рдордзреНрдпреЗ рдЪрд╛рд░ рд╡рд┐рд╖рдпрд╛рдВрдд рдмреЕрдХрд▓реЙрдЧ рд╣реЛрддреА, рддреНрдпрд╛рдкреИрдХреА рдореА Remedial рдкрд░реАрдХреНрд╖реЗрджреНрд╡рд╛рд░реЗ рджреЛрди рд╡рд┐рд╖рдп рдЙрддреНрддреАрд░реНрдг рдХреЗрд▓реЗ рдЖрд╣реЗрдд. рдорд╛рддреНрд░, рдирд╡реАрди MSI рдкреЛрд░реНрдЯрд▓рд╡рд░ рдЖрдЬрд╣реА рд╕рд░реНрд╡ рдЪрд╛рд░ рд╡рд┐рд╖рдп рдмреЕрдХрд▓реЙрдЧ рдореНрд╣рдгреВрди рджрд░реНрд╢рд╡рд▓реЗ рдЬрд╛рдд рдЖрд╣реЗрдд, рддреНрдпрд╛рдореБрд│реЗ рдорд▓рд╛ Remedial рдкрд░реАрдХреНрд╖реЗрдЪрд╛ рдлреЙрд░реНрдо рд▓реЙрдЧрд┐рдирдордзреНрдпреЗ рджрд┐рд╕рдд рдирд╛рд╣реА рдЖрдгрд┐ Supplementary рдлреЙрд░реНрдордордзреНрдпреЗ тВ╣1200 рд╕рд░реНрд╡ рдЪрд╛рд░ рд╡рд┐рд╖рдпрд╛рдВрд╕рд╛рдареА рд╢реБрд▓реНрдХ рдЖрдХрд╛рд░рд▓реЗ рдЬрд╛рдд рдЖрд╣реЗ, рдЬрд░реА рдХреЗрд╡рд│ рджреЛрдирдЪ рд╡рд┐рд╖рдп рдмрд╛рдХреА рдЕрд╕рд▓реЗ рддрд░реА.
рдорд╛рдЧреАрд▓ Remedial рдкрд░реАрдХреНрд╖реЗрдЪреНрдпрд╛ рд╡реЗрд│реА рдорд╛рдЭреНрдпрд╛ рд▓реЙрдЧрд┐рдирдордзреНрдпреЗ рдХреЛрдгрддрд╛рд╣реА рдлреЙрд░реНрдо рджрд┐рд╕рдд рдирд╡реНрд╣рддрд╛, рддреНрдпрд╛рдореБрд│реЗ рдореА рддреНрдпрд╛ рд╡реЗрд│реЗрд╕ рдлреЙрд░реНрдо рднрд░реВ рд╢рдХрд▓реЛ рдирд╛рд╣реА, рдЖрдгрд┐ рд╢реБрд▓реНрдХрд╣реА рднрд░рд▓реЗ рдЧреЗрд▓реЗ рдирд╡реНрд╣рддреЗ. рд╕рдзреНрдпрд╛ рдореА рдорд╛рдЧреАрд▓ рд╡реЗрд│рдЪреЗ тВ╣600 Remedial рд╢реБрд▓реНрдХрд╣реА рднрд░рддреЛрдп, рдЬреЗ рдЖрддрд╛ рдШреЗрддрд▓реЗ рдЬрд╛рдд рдЖрд╣реЗ.

рддреНрдпрд╛рдореБрд│реЗ рдорд╛рдЭреНрдпрд╛ рд╡рд┐рдирдВрддреНрдпрд╛ рдЦрд╛рд▓реАрд▓рдкреНрд░рдорд╛рдгреЗ:
1. Remedial рд╡ Supplementary рдкрд░реАрдХреНрд╖реЗрдЪреНрдпрд╛ рд╢реБрд▓реНрдХрд╛рдЪреЗ рдпреЛрдЧреНрдп рдкреНрд░рдХрд╛рд░реЗ рд╡рд┐рднрд╛рдЬрди (тВ╣600 + тВ╣600) рдХрд░рдгреНрдпрд╛рдд рдпрд╛рд╡реЗ, рд╡ рдпрд╛рдЪреА рд╕реНрдкрд╖реНрдЯ рдиреЛрдВрдж рдХреЗрд▓реА рдЬрд╛рд╡реА.
2. рдорд╛рдЭреНрдпрд╛ рдХреЙрд▓реЗрдЬрдиреЗ рд╕реНрдкрд╖реНрдЯрдкрдгреЗ рд╕рд╛рдВрдЧрд┐рддрд▓реЗ рдЖрд╣реЗ рдХреА, "рдЬреЗ рд╡рд┐рд╖рдп рдЙрддреНрддреАрд░реНрдг рдЭрд╛рд▓реЗ рдЖрд╣реЗрдд рддреНрдпрд╛рдВрдЪреЗ рдлреЙрд░реНрдо рднрд░реВ рдирдпреЗрдд", рдореНрд╣рдгреВрди рдореА рддреНрдпрд╛ рджреЛрди рд╡рд┐рд╖рдпрд╛рдВрд╕рд╛рдареА рдкрд░реАрдХреНрд╖реЗрд▓рд╛ рдмрд╕рдгрд╛рд░ рдирд╛рд╣реА, рдпрд╛рдЪреА рдиреЛрдВрдж рдШреНрдпрд╛рд╡реА.
3. рдЬрд░ рдореА тВ╣1200 рднрд░рд▓реЗ, рддрд░ рддреНрдпрд╛рдирдВрддрд░ рдЙрддреНрддреАрд░реНрдг рдЭрд╛рд▓реЗрд▓реЗ рджреЛрди рд╡рд┐рд╖рдп рднрд╡рд┐рд╖реНрдпрд╛рдд рдмреЕрдХрд▓реЙрдЧ рдореНрд╣рдгреВрди рджрд░реНрд╢рд╡рд▓реЗ рдЬрд╛рдгрд╛рд░ рдирд╛рд╣реАрдд, рдпрд╛рдЪреА рд▓реЗрдЦреА рдЦрд╛рддреНрд░реА (email/рдкрддреНрд░рд╛рджреНрд╡рд╛рд░реЗ) рджреНрдпрд╛рд╡реА.
4. рдорд╛рдЭреА рдорд╛рдЧреАрд▓ рд╡реЗрд│рдЪреА рдЕрдбрдЪрдг (рдлреЙрд░реНрдо рди рджрд┐рд╕рд▓реНрдпрд╛рдореБрд│реЗ рд╢реБрд▓реНрдХ рди рднрд░реВ рд╢рдХрдгреЗ) рд▓рдХреНрд╖рд╛рдд рдШреЗрдКрди Remedial рд╡ Supplementary рдкрд░реАрдХреНрд╖рд╛ рдпрд╛рдордзреНрдпреЗ рдорд╛рдЭреЗ рджреЛрди-рджреЛрди рд╡рд┐рд╖рдп рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рд╛рд╡реЗрдд.
5. рдХреГрдкрдпрд╛ рдпрд╛ рдЕрд░реНрдЬрд╛рд╡рд░ резрео рдЬреБрд▓реИ реирежреирел рдкреВрд░реНрд╡реА рдирд┐рд░реНрдгрдп рдШреЗрдгреНрдпрд╛рдд рдпрд╛рд╡рд╛, рдЬреЗрдгреЗрдХрд░реВрди рдорд▓рд╛ рди рдШрд╛рдмрд░рддрд╛ рдкреБрдвреАрд▓ рдХрд╛рд░рд╡рд╛рдИ рдХрд░рддрд╛ рдпреЗрдИрд▓ рд╡ рдкрд░реАрдХреНрд╖реЗрд▓рд╛ рдмрд╕рддрд╛ рдпреЗрдИрд▓.

рдореА рд╕рд░реНрд╡ рд╢реБрд▓реНрдХ рднрд░рдгреНрдпрд╛рд╕ рддрдпрд╛рд░ рдЖрд╣реЗ, рдкрд░рдВрддреБ рдорд▓рд╛ рднрд╡рд┐рд╖реНрдпрд╛рдд рдХреЛрдгрддреАрд╣реА рдЧреИрд░рд╕рдордЬ рдХрд┐рдВрд╡рд╛ рдЕрдиреНрдпрд╛рдп рд╣реЛрдК рдирдпреЗ рдпрд╛рд╕рд╛рдареА рд╕реНрдкрд╖реНрдЯрддрд╛ рд╡ рд╢рд╛рд╢реНрд╡рддреА рд╣рд╡реА рдЖрд╣реЗ.

рдЖрдкрд▓реНрдпрд╛ рд╕рд╣рдХрд╛рд░реНрдпрд╛рдмрджреНрджрд▓ рдорди:рдкреВрд░реНрд╡рдХ рдЖрднрд╛рд░реА рдЖрд╣реЗ.

рдЖрдкрд▓рд╛ рдирдореНрд░,

рд╡рд┐рдШреНрдиреЗрд╢ рд╕рд┐рджреНрдзреВ рдореБрдзрд╛рд│реЗ  
рджреНрд╡рд┐рддреАрдп рд╡рд░реНрд╖ рдмреА.рдЯреЗрдХ (рдЗ. & рдЯрд┐.рд╕реА.)  
PRN: 23062171372016  
Ashokrao Mane Group of Institutions (AMGOI),  
рд╡рд╛рдард╛рд░ рддрд░реНрдл рд╡рдбрдЧрд╛рд╡, рддрд╛. рд╣рд╛рддрдХрдгрдВрдЧрд▓реЗ, рдЬрд┐. рдХреЛрд▓реНрд╣рд╛рдкреВрд░  
рдореЛ.: 8483005353  
рдИрдореЗрд▓: vigneshmudhale777@gmail.com


тЬЕ Disclaimer (Notice):
ЁЯМР This is an automated email. Please pay immediate attention to the following points.
ЁЯЫС If timely action is not taken on this issue, the bot will not be stopped and will continue sending emails repeatedly.
ЁЯЩП I sincerely apologize for taking this step. Given the current situation, I had no other option, which is why I was compelled to take this action. Please view this matter with understanding and take the necessary steps.

Without your reply this bot is the not stopend 
"""
DOCUMENT_DIR = "documents"

document_paths = [
    os.path.join(DOCUMENT_DIR, "BTBS301 Engineering Mathematics-III.csv"),
    os.path.join(DOCUMENT_DIR, "BTEXC302 Electronic Devices & Circuits.csv"),
    os.path.join(DOCUMENT_DIR, "Not showing the remedial form 3rd sem .jpg")
]


def send_email():
    for recipient in recipient_list:
        try:
            msg = MIMEMultipart()
            msg['From'] = EMAIL_ADDRESS
            msg['To'] = recipient
            msg['Subject'] = subject
            msg.attach(MIMEText(body, 'plain'))

            for doc_path in document_paths:
                if os.path.exists(doc_path):
                    with open(doc_path, "rb") as f:
                        part = MIMEApplication(f.read(), Name=os.path.basename(doc_path))
                        part['Content-Disposition'] = f'attachment; filename="{os.path.basename(doc_path)}"'
                        msg.attach(part)
                else:
                    print(f"тЪая╕П File not found: {doc_path}")

            with smtplib.SMTP('smtp.gmail.com', 587) as server:
                server.starttls()
                server.login(EMAIL_ADDRESS, EMAIL_PASSWORD)
                server.sendmail(EMAIL_ADDRESS, recipient, msg.as_string())

            print(f"тЬЕ Email sent to {recipient}")
        except Exception as e:
            print(f"тЭМ Failed to send email to {recipient}: {e}")

# Schedule every 1800 seconds (30 min)
schedule.every(1800).seconds.do(send_email)

def scheduler_loop():
    while True:
        schedule.run_pending()
        time.sleep(1)

# Start scheduler in background thread
threading.Thread(target=scheduler_loop, daemon=True).start()

@app.route('/')
def home():
    return "ЁЯУз Auto Email Sender is Running on Koyeb with Port 8080"

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
